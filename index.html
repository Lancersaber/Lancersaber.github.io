<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.2">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.2">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.2">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.2" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.2">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.4.2',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Lancersaber">
<meta property="og:url" content="https:&#x2F;&#x2F;lancersaber.github.io&#x2F;index.html">
<meta property="og:site_name" content="Lancersaber">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://lancersaber.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Lancersaber</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Lancersaber</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://lancersaber.github.io/2020/06/01/Android/zuoye2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lancersaber">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lancersaber">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/01/Android/zuoye2/" class="post-title-link" itemprop="url">Android实现蓝牙聊天功能</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-06-01 22:26:02 / Modified: 22:31:33" itemprop="dateCreated datePublished" datetime="2020-06-01T22:26:02+08:00">2020-06-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Android实现蓝牙聊天功能"><a href="#Android实现蓝牙聊天功能" class="headerlink" title="Android实现蓝牙聊天功能"></a>Android实现蓝牙聊天功能</h1><hr>
<p>src/main/AndroidManifest.xml 中插入mainfest标签下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=&quot;android.permission.BLUETOOTH&quot; /&gt;</span><br><span class="line">    &lt;uses-permission android:name=&quot;android.permission.BLUETOOTH_ADMIN&quot; /&gt;</span><br><span class="line">    &lt;uses-permission android:name=&quot;android.permission.BLUETOOTH_PRIVILEGED&quot; /&gt;</span><br><span class="line">    &lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;/&gt;</span><br><span class="line">    &lt;uses-permission android:name=&quot;android.permission.READ_EXTERNAL_STORAGE&quot;/&gt;</span><br><span class="line">    &lt;uses-permission android:name=&quot;android.permission.SYSTEM_ALERT_WINDOW&quot;/&gt;</span><br></pre></td></tr></table></figure>

<p>然后就是src/main/java/cn/com/lenew/bluetooth/activity/MainActivity.java<br>没有别的，主要还是一个对各个类的调用，控制显示之类的<br>仅附上部分代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">public void onClick(View view)&#123;</span><br><span class="line">        showToast(&quot;开始扫描&quot;);</span><br><span class="line">        list.clear();</span><br><span class="line">        list.addAll(BluetoothUtils.getInstance(mContext).getAvailableDevices());</span><br><span class="line">        adapter.notifyDataSetChanged();</span><br><span class="line">        BluetoothUtils.getInstance(this).scanDevices();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initReceiver() &#123;</span><br><span class="line">        IntentFilter filter = new IntentFilter();</span><br><span class="line">        filter.addAction(BluetoothDevice.ACTION_FOUND);</span><br><span class="line">        filter.addAction(BluetoothAdapter.ACTION_DISCOVERY_STARTED);</span><br><span class="line">        filter.addAction(BluetoothAdapter.ACTION_DISCOVERY_FINISHED);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        filter.addAction(BluetoothMessage.ACTION_INIT_COMPLETE);</span><br><span class="line">        filter.addAction(BluetoothMessage.ACTION_CONNECTED_SERVER);</span><br><span class="line">        filter.addAction(BluetoothMessage.ACTION_CONNECT_ERROR);</span><br><span class="line">        registerReceiver(receiver, filter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    BroadcastReceiver receiver = new BroadcastReceiver() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onReceive(Context context, Intent intent) &#123;</span><br><span class="line">            switch (intent.getAction())&#123;</span><br><span class="line">                case BluetoothDevice.ACTION_FOUND:</span><br><span class="line">                    BluetoothDevice device = intent.getParcelableExtra(BluetoothDevice.EXTRA_DEVICE);</span><br><span class="line">                    for(int i=0;i&lt;list.size();i++)&#123;</span><br><span class="line">                        if(device.getAddress()==null || device.getAddress().equals(list.get(i).getAddress()))&#123;</span><br><span class="line">                            return;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    list.add(device);</span><br><span class="line">                    adapter.notifyDataSetChanged();</span><br><span class="line">                    break;</span><br><span class="line">                case BluetoothAdapter.ACTION_DISCOVERY_STARTED:</span><br><span class="line">//                    showToast(&quot;开始扫描&quot;);</span><br><span class="line">                    break;</span><br><span class="line">                case BluetoothAdapter.ACTION_DISCOVERY_FINISHED:</span><br><span class="line">//                    showToast(&quot;扫描完成&quot;);</span><br><span class="line">                    break;</span><br><span class="line">                case BluetoothMessage.ACTION_INIT_COMPLETE:</span><br><span class="line">                    ProgressUtils.dismissProgress();</span><br><span class="line">                    break;</span><br><span class="line">                case BluetoothMessage.ACTION_CONNECTED_SERVER:</span><br><span class="line">                    ProgressUtils.dismissProgress();</span><br><span class="line">                    String remoteAddress = intent.getStringExtra(BluetoothUtils.EXTRA_REMOTE_ADDRESS);</span><br><span class="line">                    openChatRoom(remoteAddress);</span><br><span class="line">                    break;</span><br><span class="line">                case BluetoothMessage.ACTION_CONNECT_ERROR:</span><br><span class="line">                    ProgressUtils.dismissProgress();</span><br><span class="line">                    showToast(intent.getStringExtra(BluetoothUtils.EXTRA_ERROR_MSG));</span><br><span class="line">                    break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    private void openChatRoom(String remoteAddress) &#123;</span><br><span class="line">        Intent intent = new Intent(mContext,ChatActivity.class);</span><br><span class="line">        intent.putExtra(&quot;remoteAddress&quot;,remoteAddress);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>随后就是蓝牙通信的协议问题，这个相对来说就比较复杂了<br>这里说一下 ，我使用的是BluetoothSocket和BluetoothServerSocket<br>src/main/java/cn/com/lenew/bluetooth/utils/BluetoothUtils.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by xuhuan 0007.</span><br><span class="line"> */</span><br><span class="line">public class BluetoothUtils &#123;</span><br><span class="line"></span><br><span class="line">    private static final String PROTOCOL_SCHEME_RFCOMM = &quot;server_name&quot;;</span><br><span class="line">    private static final String UUIDString = &quot;00001101-0000-1000-8000-00805F9B34FB&quot;;</span><br><span class="line">    public static final String EXTRA_REMOTE_ADDRESS = &quot;remoteAddress&quot;;</span><br><span class="line">    public static final String EXTRA_ERROR_MSG = &quot;error_msg&quot;;</span><br><span class="line">    private static BluetoothUtils instance;</span><br><span class="line"></span><br><span class="line">    /** 已连接到服务器 */</span><br><span class="line">    private static final int CONNECTED_SERVER = 1;</span><br><span class="line">    /** 连接服务器出错 */</span><br><span class="line">    private static final int CONNECT_SERVER_ERROR = CONNECTED_SERVER + 1;</span><br><span class="line">    /** 正在连接服务器 */</span><br><span class="line">    private static final int IS_CONNECTING_SERVER = CONNECT_SERVER_ERROR + 1;</span><br><span class="line">    /** 等待客户端连接 */</span><br><span class="line">    private static final int WAITING_FOR_CLIENT = IS_CONNECTING_SERVER + 1;</span><br><span class="line">    /** 已连接客户端 */</span><br><span class="line">    private static final int CONNECTED_CLIENT = WAITING_FOR_CLIENT + 1;</span><br><span class="line">    /** 连接客户端出错 */</span><br><span class="line">    private static final int CONNECT_CLIENT_ERROR = CONNECTED_CLIENT + 1;</span><br><span class="line"></span><br><span class="line">    private BluetoothAdapter bluetoothAdapter;</span><br><span class="line">    private Context mContext;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * socket集合</span><br><span class="line">     */</span><br><span class="line">    private HashMap&lt;String, BluetoothSocket&gt; socketMap = new HashMap&lt;&gt;();</span><br><span class="line">    /**</span><br><span class="line">     * 远程设备集合</span><br><span class="line">     */</span><br><span class="line">//    private HashMap&lt;String, BluetoothDevice&gt; remoteDeviceMap = new HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    private HashMap&lt;String,ReadThread&gt; readThreadMap = new HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    private BluetoothServerSocket mServerSocket;</span><br><span class="line"></span><br><span class="line">    private Handler linkDetectedHandler = new Handler() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void handleMessage(Message msg) &#123;</span><br><span class="line"></span><br><span class="line">            if(msg.obj instanceof BluetoothMessage)&#123;</span><br><span class="line">                BluetoothMessage message = (BluetoothMessage) msg.obj;</span><br><span class="line">                Intent intent = new Intent();</span><br><span class="line">                intent.setAction(BluetoothMessage.ACTION_RECEIVED_NEW_MSG);</span><br><span class="line">                intent.putExtra(&quot;msg&quot;, message);</span><br><span class="line">                mContext.sendOrderedBroadcast(intent, null);</span><br><span class="line"></span><br><span class="line">                DBManager.save(message);</span><br><span class="line">//                mContext.sendBroadcast(intent);</span><br><span class="line">            &#125;else &#123;</span><br><span class="line">                Intent intent = new Intent();</span><br><span class="line">                switch (msg.what)&#123;</span><br><span class="line">                    case WAITING_FOR_CLIENT:</span><br><span class="line">                        //初始化服务器完成</span><br><span class="line">                        intent.setAction(BluetoothMessage.ACTION_INIT_COMPLETE);</span><br><span class="line">                        break;</span><br><span class="line">                    case IS_CONNECTING_SERVER:</span><br><span class="line">                        //正在连接服务器</span><br><span class="line"></span><br><span class="line">                        break;</span><br><span class="line">                    case CONNECTED_CLIENT:</span><br><span class="line">                        //有客户端连接到自己</span><br><span class="line"></span><br><span class="line">                        break;</span><br><span class="line">                    case CONNECT_CLIENT_ERROR:</span><br><span class="line">                        //连接客户端出错</span><br><span class="line"></span><br><span class="line">                        break;</span><br><span class="line">                    case CONNECT_SERVER_ERROR:</span><br><span class="line">                        //连接服务器出错</span><br><span class="line">                        intent.putExtra(EXTRA_ERROR_MSG,(String)msg.obj);</span><br><span class="line">                        intent.setAction(BluetoothMessage.ACTION_CONNECT_ERROR);</span><br><span class="line">                        break;</span><br><span class="line">                    case CONNECTED_SERVER:</span><br><span class="line">                        intent.putExtra(EXTRA_REMOTE_ADDRESS,(String)msg.obj);</span><br><span class="line">                        intent.setAction(BluetoothMessage.ACTION_CONNECTED_SERVER);</span><br><span class="line">                        break;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                mContext.sendBroadcast(intent);</span><br><span class="line">//                String msgContent = (String) msg.obj;</span><br><span class="line">//                Toast.makeText(mContext, msgContent, Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private BluetoothUtils(Context context) &#123;</span><br><span class="line">        mContext = context;</span><br><span class="line">        if (context == null) &#123;</span><br><span class="line">            throw new RuntimeException(&quot;Parameter context can not be null !&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        bluetoothAdapter = BluetoothAdapter.getDefaultAdapter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static BluetoothUtils getInstance(Context context) &#123;</span><br><span class="line">        if (instance == null) &#123;</span><br><span class="line">            instance = new BluetoothUtils(context);</span><br><span class="line">        &#125;</span><br><span class="line">        return instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void enableBluetooth() &#123;</span><br><span class="line">        if (!bluetoothAdapter.isEnabled()) &#123;</span><br><span class="line">//            Intent intent = new Intent(BluetoothAdapter.ACTION_REQUEST_DISCOVERABLE);</span><br><span class="line">//            intent.putExtra(BluetoothAdapter.EXTRA_DISCOVERABLE_DURATION, 300);</span><br><span class="line">//            mContext.startActivity(intent);</span><br><span class="line">            bluetoothAdapter.enable();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void scanDevices() &#123;</span><br><span class="line">        if (!bluetoothAdapter.isEnabled()) &#123;</span><br><span class="line">            enableBluetooth();</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        bluetoothAdapter.startDiscovery();</span><br><span class="line">        startService();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void startService() &#123;</span><br><span class="line">        Intent serverIntent = new Intent(mContext, ServerService.class);</span><br><span class="line">        mContext.startService(serverIntent);</span><br><span class="line"></span><br><span class="line">        Intent clientIntent = new Intent(mContext, MessageService.class);</span><br><span class="line">        mContext.startService(clientIntent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean isEnabled() &#123;</span><br><span class="line">        return bluetoothAdapter.isEnabled();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ArrayList&lt;BluetoothDevice&gt; getAvailableDevices() &#123;</span><br><span class="line">        Set&lt;BluetoothDevice&gt; availableDevices = bluetoothAdapter.getBondedDevices();</span><br><span class="line">        ArrayList availableList = new ArrayList();</span><br><span class="line">        for (Iterator&lt;BluetoothDevice&gt; iterator = availableDevices.iterator(); iterator.hasNext(); ) &#123;</span><br><span class="line">            availableList.add(iterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">        return availableList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean isBonded(BluetoothDevice device) &#123;</span><br><span class="line">        Set&lt;BluetoothDevice&gt; availableDevices = bluetoothAdapter.getBondedDevices();</span><br><span class="line">        for (Iterator&lt;BluetoothDevice&gt; iterator = availableDevices.iterator(); iterator.hasNext(); ) &#123;</span><br><span class="line">            if (device.getAddress().equals(iterator.next().getAddress())) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean isDiscoverying() &#123;</span><br><span class="line">        return bluetoothAdapter.isDiscovering();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void cancelScan() &#123;</span><br><span class="line">        bluetoothAdapter.cancelDiscovery();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //开启客户端</span><br><span class="line">    private class ClientThread extends Thread &#123;</span><br><span class="line"></span><br><span class="line">        private String remoteAddress;</span><br><span class="line"></span><br><span class="line">        public ClientThread(String remoteAddress) &#123;</span><br><span class="line">            this.remoteAddress = remoteAddress;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                //创建一个Socket连接：只需要服务器在注册时的UUID号</span><br><span class="line">                // socket = device.createRfcommSocketToServiceRecord(BluetoothProtocols.OBEX_OBJECT_PUSH_PROTOCOL_UUID);</span><br><span class="line">                BluetoothDevice device = bluetoothAdapter.getRemoteDevice(remoteAddress);</span><br><span class="line">                BluetoothSocket socket = device.createRfcommSocketToServiceRecord(UUID.fromString(UUIDString));</span><br><span class="line">//                socketMap.put(remoteAddress, socket);</span><br><span class="line">                //连接</span><br><span class="line">                Message msg2 = new Message();</span><br><span class="line">                msg2.obj = &quot;请稍候，正在连接服务器:&quot; + remoteAddress;</span><br><span class="line">                msg2.what = IS_CONNECTING_SERVER;</span><br><span class="line">                linkDetectedHandler.sendMessage(msg2);</span><br><span class="line"></span><br><span class="line">                socket.connect();</span><br><span class="line"></span><br><span class="line">//                socketMap.put(BluetoothMessage.bluetoothAddress, socket);</span><br><span class="line">                socketMap.put(remoteAddress, socket);</span><br><span class="line"></span><br><span class="line">                Message msg = new Message();</span><br><span class="line">//                msg.obj = &quot;已经连接上服务端！可以发送信息。&quot;;</span><br><span class="line">                msg.obj = remoteAddress;</span><br><span class="line">                msg.what = CONNECTED_SERVER;</span><br><span class="line">                linkDetectedHandler.sendMessage(msg);</span><br><span class="line">                //启动接受数据</span><br><span class="line">                ReadThread mreadThread = new ReadThread(remoteAddress);</span><br><span class="line">                readThreadMap.put(remoteAddress,mreadThread);</span><br><span class="line">                mreadThread.start();</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                socketMap.remove(remoteAddress);</span><br><span class="line">                Log.e(&quot;connect&quot;, e.getMessage(), e);</span><br><span class="line">                Message msg = new Message();</span><br><span class="line">                msg.obj = &quot;连接服务端异常！断开连接重新试一试。&quot;+e.getMessage();</span><br><span class="line">                msg.what = CONNECT_SERVER_ERROR;</span><br><span class="line">                linkDetectedHandler.sendMessage(msg);</span><br><span class="line"></span><br><span class="line">//                remoteDeviceMap.remove(remoteAddress);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //开启服务器</span><br><span class="line">    private class ServerThread extends Thread &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line"></span><br><span class="line">            try &#123;</span><br><span class="line">                    /* 创建一个蓝牙服务器</span><br><span class="line">                     * 参数分别：服务器名称、UUID   */</span><br><span class="line">                mServerSocket = bluetoothAdapter.listenUsingRfcommWithServiceRecord(PROTOCOL_SCHEME_RFCOMM, UUID.fromString(UUIDString));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                while (true)&#123;</span><br><span class="line">                    Log.d(&quot;server&quot;, &quot;wait cilent connect...&quot;);</span><br><span class="line"></span><br><span class="line">                    Message msg = new Message();</span><br><span class="line">                    msg.obj = &quot;请稍候，正在等待客户端的连接...&quot;;</span><br><span class="line">                    msg.what = WAITING_FOR_CLIENT;</span><br><span class="line">                    linkDetectedHandler.sendMessage(msg);</span><br><span class="line"></span><br><span class="line">                    /* 接受客户端的连接请求 */</span><br><span class="line">                    BluetoothSocket socket = mServerSocket.accept();</span><br><span class="line">                    socketMap.put(socket.getRemoteDevice().getAddress(), socket);</span><br><span class="line">//                    remoteDeviceMap.put(socket.getRemoteDevice().getAddress(),socket.getRemoteDevice());</span><br><span class="line">                    Log.d(&quot;server&quot;, &quot;accept success !&quot;);</span><br><span class="line"></span><br><span class="line">                    Message msg2 = new Message();</span><br><span class="line">                    String info = &quot;客户端已经连接上！可以发送信息。&quot;;</span><br><span class="line">                    msg2.obj = info;</span><br><span class="line">                    msg.what = CONNECTED_CLIENT;</span><br><span class="line">                    linkDetectedHandler.sendMessage(msg2);</span><br><span class="line">                    //启动接受数据</span><br><span class="line">                    ReadThread mreadThread = new ReadThread(socket.getRemoteDevice().getAddress());</span><br><span class="line">                    readThreadMap.put(socket.getRemoteDevice().getAddress(),mreadThread);</span><br><span class="line">                    mreadThread.start();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* 停止服务器 */</span><br><span class="line">//略</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /* 停止客户端连接 */</span><br><span class="line">//略</span><br><span class="line">    //发送数据</span><br><span class="line">//略</span><br><span class="line"></span><br><span class="line">    //读取数据</span><br><span class="line">//略</span><br></pre></td></tr></table></figure>
<p>接下来是通信服务：<br>src/main/java/cn/com/lenew/bluetooth/service/MessageService.java：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by xuhuan  0010.</span><br><span class="line"> */</span><br><span class="line">public class MessageService extends Service&#123;</span><br><span class="line">    private Context mContext;</span><br><span class="line">    private NotificationManager notificationManager;</span><br><span class="line"></span><br><span class="line">    @Nullable</span><br><span class="line">    @Override</span><br><span class="line">    public IBinder onBind(Intent intent) &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate() &#123;</span><br><span class="line">        super.onCreate();</span><br><span class="line">        mContext = this;</span><br><span class="line">        notificationManager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);</span><br><span class="line">        IntentFilter intentFilter = new IntentFilter(BluetoothMessage.ACTION_RECEIVED_NEW_MSG);</span><br><span class="line">        intentFilter.setPriority(990);</span><br><span class="line">        registerReceiver(msgReceiver, intentFilter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onDestroy() &#123;</span><br><span class="line">        super.onDestroy();</span><br><span class="line">        unregisterReceiver(msgReceiver);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int onStartCommand(Intent intent, int flags, int startId) &#123;</span><br><span class="line">        return Service.START_STICKY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public void sendNotification(String content,String remoteAddress,BluetoothMessage message)&#123;</span><br><span class="line"></span><br><span class="line">        Intent chatIntent = new Intent(mContext, ChatActivity.class);</span><br><span class="line">        chatIntent.putExtra(&quot;remoteAddress&quot;,remoteAddress);</span><br><span class="line">        chatIntent.putExtra(&quot;lastmsg&quot;,message);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        PendingIntent pendingIntent = PendingIntent.getActivity(mContext, 0, chatIntent, PendingIntent.FLAG_UPDATE_CURRENT);</span><br><span class="line">        Notification notification = new Notification.Builder(mContext)</span><br><span class="line">                .setContentText(content)</span><br><span class="line">                .setContentIntent(pendingIntent)</span><br><span class="line">                .setSmallIcon(R.mipmap.icon_logo)</span><br><span class="line">                .setAutoCancel(true)</span><br><span class="line">                .setContentTitle(&quot;您有一条新消息&quot;)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        notification.defaults = Notification.DEFAULT_SOUND;</span><br><span class="line">        notificationManager.notify(1,notification);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    BroadcastReceiver msgReceiver = new BroadcastReceiver() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onReceive(Context context, Intent intent) &#123;</span><br><span class="line">            BluetoothMessage bluetoothMessage = (BluetoothMessage) intent.getSerializableExtra(&quot;msg&quot;);</span><br><span class="line">            bluetoothMessage.setIsMe(0);</span><br><span class="line"></span><br><span class="line">            String remoteAddress = bluetoothMessage.getSender();</span><br><span class="line"></span><br><span class="line">            String msgContent;</span><br><span class="line">            if(bluetoothMessage.getContent().length()&gt;10)&#123;</span><br><span class="line">                msgContent = bluetoothMessage.getContent().substring(0,10);</span><br><span class="line">            &#125;else &#123;</span><br><span class="line">                msgContent = bluetoothMessage.getContent();</span><br><span class="line">            &#125;</span><br><span class="line">            String msg = bluetoothMessage.getSenderNick()+&quot;:&quot;+msgContent;</span><br><span class="line"></span><br><span class="line">            sendNotification(msg,remoteAddress,bluetoothMessage);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>数据服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by xuhuan .</span><br><span class="line"> */</span><br><span class="line">public class DBManager &#123;</span><br><span class="line"></span><br><span class="line">    private static DbManager.DaoConfig daoConfig;</span><br><span class="line"></span><br><span class="line">    public static DbManager.DaoConfig getDaoConfig()&#123;</span><br><span class="line">        if(daoConfig==null)&#123;</span><br><span class="line">            daoConfig = new DbManager.DaoConfig();</span><br><span class="line">            daoConfig.setDbVersion(2);</span><br><span class="line">        &#125;</span><br><span class="line">        return daoConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static void save(Object obj)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            x.getDb(DBManager.getDaoConfig()).save(obj);</span><br><span class="line">        &#125; catch (DbException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static List&lt;BluetoothMessage&gt; findAll(String remoteAddress) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line"></span><br><span class="line">            Selector&lt;BluetoothMessage&gt; selector = x.getDb(getDaoConfig()).selector(BluetoothMessage.class);</span><br><span class="line">            selector.where(&quot;sender&quot;,&quot;=&quot;,remoteAddress);</span><br><span class="line">            selector.or(&quot;receiver&quot;,&quot;=&quot;,remoteAddress);</span><br><span class="line">            return selector.findAll();</span><br><span class="line">        &#125; catch (DbException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上就是项目的大致代码了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://lancersaber.github.io/2020/05/25/Android/zuoye/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lancersaber">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lancersaber">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/25/Android/zuoye/" class="post-title-link" itemprop="url">百度地图</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-05-25 23:27:45 / Modified: 23:55:50" itemprop="dateCreated datePublished" datetime="2020-05-25T23:27:45+08:00">2020-05-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="百度地图"><a href="#百度地图" class="headerlink" title="百度地图"></a>百度地图</h1><hr>
<h2 id="配置环境和权限"><a href="#配置环境和权限" class="headerlink" title="配置环境和权限"></a>配置环境和权限</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;manifest xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    package=<span class="string">"com.example.mybaidulcoate"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--</span><br><span class="line">         The ACCESS_COARSE/FINE_LOCATION permissions are not required to use</span><br><span class="line">         Google Maps Android API v2, but you must specify either coarse or fine</span><br><span class="line">         location permissions <span class="keyword">for</span> the <span class="string">'MyLocation'</span> functionality.</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;!-- 这个权限用于进行网络定位--&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_COARSE_LOCATION"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">uses-permission</span>&gt;</span></span></span><br><span class="line">    &lt;!-- 这个权限用于访问GPS定位--&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_FINE_LOCATION"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">uses-permission</span>&gt;</span></span></span><br><span class="line">    &lt;!-- 用于访问wifi网络信息，wifi信息会用于进行网络定位--&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_WIFI_STATE"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">uses-permission</span>&gt;</span></span></span><br><span class="line">    &lt;!-- 获取运营商信息，用于支持提供运营商信息相关的接口--&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_NETWORK_STATE"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">uses-permission</span>&gt;</span></span></span><br><span class="line">    &lt;!-- 这个权限用于获取wifi的获取权限，wifi信息会用来进行网络定位--&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.CHANGE_WIFI_STATE"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">uses-permission</span>&gt;</span></span></span><br><span class="line">    &lt;!-- 用于读取手机当前的状态--&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.READ_PHONE_STATE"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">uses-permission</span>&gt;</span></span></span><br><span class="line">    &lt;!-- 写入扩展存储，向扩展卡写入数据，用于写入离线定位数据--&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.WRITE_EXTERNAL_STORAGE"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">uses-permission</span>&gt;</span></span></span><br><span class="line">    &lt;!-- 访问网络，网络定位需要上网--&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.INTERNET"</span> /&gt;</span><br><span class="line">    &lt;!-- SD卡读取权限，用户写入离线定位数据--&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置定位SDK参数</span></span><br><span class="line">    private <span class="keyword">void</span> initLocation() &#123;</span><br><span class="line">        LocationClientOption option = <span class="keyword">new</span> LocationClientOption();</span><br><span class="line">        option.setLocationMode(LocationClientOption.LocationMode.Hight_Accuracy</span><br><span class="line">        );<span class="comment">//可选，默认高精度，设置定位模式，高精度，低功耗，仅设备</span></span><br><span class="line">        option.setCoorType(<span class="string">"bd09ll"</span>);<span class="comment">//可选，默认gcj02，设置返回的定位结果坐标系</span></span><br><span class="line">        int span = <span class="number">1000</span>;</span><br><span class="line">        option.setScanSpan(span);<span class="comment">//可选，默认0，即仅定位一次，设置发起定位请求的间隔需要大于等于1000ms才是有效的</span></span><br><span class="line">        option.setIsNeedAddress(<span class="literal">true</span>);<span class="comment">//可选，设置是否需要地址信息，默认不需要</span></span><br><span class="line">        option.setOpenGps(<span class="literal">true</span>);<span class="comment">//可选，默认false,设置是否使用gps</span></span><br><span class="line">        option.setLocationNotify(<span class="literal">true</span>);<span class="comment">//可选，默认false，设置是否当GPS有效时按照1S/1次频率输出GPS结果</span></span><br><span class="line">        option.setIsNeedLocationDescribe(<span class="literal">true</span>);<span class="comment">//可选，默认false，设置是否需要位置语义化结果，可以在BDLocation</span></span><br><span class="line">        <span class="comment">// .getLocationDescribe里得到，结果类似于“在北京天安门附近”</span></span><br><span class="line">        option.setIsNeedLocationPoiList(<span class="literal">true</span>);<span class="comment">//可选，默认false，设置是否需要POI结果，可以在BDLocation.getPoiList里得到</span></span><br><span class="line">        option.setIgnoreKillProcess(<span class="literal">false</span>);</span><br><span class="line">        option.setOpenGps(<span class="literal">true</span>); <span class="comment">// 打开gps</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//可选，默认true，定位SDK内部是一个SERVICE，并放到了独立进程，设置是否在stop的时候杀死这个进程，默认不杀死</span></span><br><span class="line">        option.SetIgnoreCacheException(<span class="literal">false</span>);<span class="comment">//可选，默认false，设置是否收集CRASH信息，默认收集</span></span><br><span class="line">        option.setEnableSimulateGps(<span class="literal">false</span>);<span class="comment">//可选，默认false，设置是否需要过滤GPS仿真结果，默认需要</span></span><br><span class="line">        mLocationClient.setLocOption(option);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//实现BDLocationListener接口,BDLocationListener为结果监听接口，异步获取定位结果</span></span><br><span class="line">    public <span class="class"><span class="keyword">class</span> <span class="title">MyLocationListener</span> <span class="title">implements</span> <span class="title">BDLocationListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public <span class="keyword">void</span> onReceiveLocation(BDLocation location) &#123;</span><br><span class="line">            latLng = <span class="keyword">new</span> LatLng(location.getLatitude(),location.getLongitude());</span><br><span class="line">            <span class="comment">// 构造定位数据</span></span><br><span class="line">            MyLocationData locData = <span class="keyword">new</span> MyLocationData.Builder()</span><br><span class="line">                    .accuracy(location.getRadius())</span><br><span class="line">                    <span class="comment">// 此处设置开发者获取到的方向信息，顺时针0-360</span></span><br><span class="line">                    .direction(<span class="number">100</span>).latitude(location.getLatitude())</span><br><span class="line">                    .longitude(location.getLongitude()).build();</span><br><span class="line">            <span class="comment">// 设置定位数据</span></span><br><span class="line">            mBaiduMap.setMyLocationData(locData);</span><br><span class="line">            <span class="comment">// 当不需要定位图层时关闭定位图层</span></span><br><span class="line">            <span class="comment">//mBaiduMap.setMyLocationEnabled(false);</span></span><br><span class="line">            <span class="keyword">if</span> (isFirstLoc) &#123;</span><br><span class="line">                isFirstLoc = <span class="literal">false</span>;</span><br><span class="line">                LatLng ll = <span class="keyword">new</span> LatLng(location.getLatitude(),</span><br><span class="line">                        location.getLongitude());</span><br><span class="line">                MapStatus.Builder builder = <span class="keyword">new</span> MapStatus.Builder();</span><br><span class="line">                builder.target(ll).zoom(<span class="number">18.0</span>f);</span><br><span class="line">                mBaiduMap.animateMapStatus(MapStatusUpdateFactory.newMapStatus(builder.build()));</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (location.getLocType() == BDLocation.TypeGpsLocation) &#123;</span><br><span class="line">                    <span class="comment">// GPS定位结果</span></span><br><span class="line">                    Toast.makeText(MainActivity.this, location.getAddrStr(), Toast.LENGTH_SHORT).show();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (location.getLocType() == BDLocation.TypeNetWorkLocation) &#123;</span><br><span class="line">                    <span class="comment">// 网络定位结果</span></span><br><span class="line">                    Toast.makeText(MainActivity.this, location.getAddrStr(), Toast.LENGTH_SHORT).show();</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (location.getLocType() == BDLocation.TypeOffLineLocation) &#123;</span><br><span class="line">                    <span class="comment">// 离线定位结果</span></span><br><span class="line">                    Toast.makeText(MainActivity.this, location.getAddrStr(), Toast.LENGTH_SHORT).show();</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (location.getLocType() == BDLocation.TypeServerError) &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.this, <span class="string">"服务器错误，请检查"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (location.getLocType() == BDLocation.TypeNetWorkException) &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.this, <span class="string">"网络错误，请检查"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (location.getLocType() == BDLocation.TypeCriteriaException) &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.this, <span class="string">"手机模式错误，请检查是否飞行"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>然后修改build.gradle文件，类似于：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">'com.android.application'</span></span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">25</span></span><br><span class="line">    buildToolsVersion <span class="string">"25.0.0"</span></span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId <span class="string">"stark.a.is.zhang.maptest"</span></span><br><span class="line">        minSdkVersion <span class="number">16</span></span><br><span class="line">        targetSdkVersion <span class="number">25</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">"1.0"</span></span><br><span class="line"></span><br><span class="line">        testInstrumentationRunner <span class="string">"android.support.test.runner.AndroidJUnitRunner"</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled <span class="literal">false</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.pro'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//增加jniLibs的描述，这样APK才知道so库的路径</span></span><br><span class="line">    sourceSets &#123;</span><br><span class="line">        main &#123;</span><br><span class="line">            jniLibs.srcDirs = [<span class="string">'libs'</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile fileTree(include: [<span class="string">'*.jar'</span>], <span class="attr">dir</span>: <span class="string">'libs'</span>)</span><br><span class="line">    androidTestCompile(<span class="string">'com.android.support.test.espresso:espresso-core:2.2.2'</span>, &#123;</span><br><span class="line">        exclude group: <span class="string">'com.android.support'</span>, <span class="attr">module</span>: <span class="string">'support-annotations'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    compile <span class="string">'com.android.support:appcompat-v7:25.1.0'</span></span><br><span class="line">    testCompile <span class="string">'junit:junit:4.12'</span></span><br><span class="line">    <span class="comment">//这个是自己为了方便，定义的库</span></span><br><span class="line">    compile project(<span class="string">':activityLib'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//主要是这里，需要添加百度SDK jar包路径</span></span><br><span class="line">    compile files(<span class="string">'libs/BaiduLBS_Android.jar'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5、视图及初始化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</span><br><span class="line">&lt;RelativeLayout</span><br><span class="line">    xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">    android:layout_height=<span class="string">"match_parent"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:id=<span class="string">"@+id/linear_layout"</span></span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"wrap_content"</span>&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=<span class="string">"@+id/show_location"</span></span><br><span class="line">            android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">            android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">            android:layout_weight=<span class="string">"0.5"</span></span><br><span class="line">            android:text=<span class="string">"@string/show_location"</span></span><br><span class="line">            android:layout_marginLeft=<span class="string">"16dp"</span>/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=<span class="string">"@+id/clear_location"</span></span><br><span class="line">            android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">            android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">            android:layout_weight=<span class="string">"0.5"</span></span><br><span class="line">            android:text=<span class="string">"@string/clear_location"</span></span><br><span class="line">            android:layout_marginRight=<span class="string">"16dp"</span>/&gt;</span><br><span class="line">    &lt;<span class="regexp">/LinearLayout&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    &lt;!--主要是这里，与使用自定义视图的方法类似 --&gt;</span></span><br><span class="line"><span class="regexp">    &lt;com.baidu.mapapi.map.MapView</span></span><br><span class="line"><span class="regexp">        android:id="@+id/</span>bmapView<span class="string">"</span></span><br><span class="line"><span class="string">        android:layout_width="</span>match_parent<span class="string">"</span></span><br><span class="line"><span class="string">        android:layout_height="</span>match_parent<span class="string">"</span></span><br><span class="line"><span class="string">        android:layout_below="</span>@id/linear_layout<span class="string">"</span></span><br><span class="line"><span class="string">        android:clickable="</span><span class="literal">true</span><span class="string">" /&gt;</span></span><br><span class="line"><span class="string">&lt;/RelativeLayout&gt;</span></span><br></pre></td></tr></table></figure>

<p>6、基本接口的使用<br>6.1、视图显示和生命周期的管理<br>我们首先看看加载百度地图的视图及其生命周期管理相关的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MapTestFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span></span>&#123;</span><br><span class="line">    MapView mMapView = <span class="literal">null</span>;</span><br><span class="line">    BaiduMap mBaiduMap = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    ...................</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public View onCreateView(LayoutInflater inflater, ViewGroup container,</span><br><span class="line">            Bundle savedInstanceState) &#123;</span><br><span class="line">        View v = inflater.inflate(R.layout.fragment_map_test, container, <span class="literal">false</span>);</span><br><span class="line">        ...................</span><br><span class="line">        <span class="comment">//加载视图后，获取MapView</span></span><br><span class="line">        mMapView = (MapView) v.findViewById(R.id.bmapView);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//得到BaiduMap的实例</span></span><br><span class="line">        mBaiduMap = mMapView.getMap();</span><br><span class="line">        <span class="comment">//设置Baidu的地图类型，具有MAP_TYPE_NONE、MAP_TYPE_NORMAL和MAP_TYPE_SATELLITE</span></span><br><span class="line">        mBaiduMap.setMapType(BaiduMap.MAP_TYPE_NORMAL);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//MapView与Activity、Fragment的生命周期匹配</span></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> onResume() &#123;</span><br><span class="line">        <span class="keyword">super</span>.onResume();</span><br><span class="line">        mMapView.onResume();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> onPause() &#123;</span><br><span class="line">        <span class="keyword">super</span>.onPause();</span><br><span class="line">        mMapView.onPause();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> onDestroy() &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        mMapView.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line">    ..................</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/05/25/Lx4OUqK9Bzn2ZkX.jpg" alt="20170301170901166.jpg"></p>
<p>总结<br>实际上，最初自己是想以Google地图为例，记录一下地图的基本使用方法。<br>不过Google地图的一些功能依赖于Google Play相关的服务，不管怎么讲，翻墙多少还是有些麻烦的，<br>于是退而求其次，决定利用百度地图作为例子。</p>
<p>自己主要是做Framework的，系统应用接触的比较多，还是初次在APK中使用地图。<br>从自己的使用感受来讲，不吹不黑，百度SDK做的还是很用心的，文档和demo写的都不错。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://lancersaber.github.io/2020/05/23/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/shiro/Shiro%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90(2)-SessionManager/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lancersaber">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lancersaber">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/23/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/shiro/Shiro%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90(2)-SessionManager/" class="post-title-link" itemprop="url">Shiro源码分析(2)-SessionManager</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-23 18:59:31" itemprop="dateCreated datePublished" datetime="2020-05-23T18:59:31+08:00">2020-05-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-25 23:55:50" itemprop="dateModified" datetime="2020-05-25T23:55:50+08:00">2020-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/sourceread/" itemprop="url" rel="index">
                    <span itemprop="name">sourceread</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Shiro源码分析-2-SessionManager"><a href="#Shiro源码分析-2-SessionManager" class="headerlink" title="Shiro源码分析(2)-SessionManager"></a>Shiro源码分析(2)-SessionManager</h1><hr>
<p>本文对Shiro中的SessionManager进行分析，SessionManager用于管理Shiro中的Session信息。Session也就是我们通常说的会话，会话是用户在使用应用程序一段时间内携带的数据。传统的会话一般是基于Web容器(如:Tomcat、EJB环境等)。Shiro提供的Session可以在任何环境中使用，不再依赖于其他容器。</p>
<p>Shiro还提供了一些其他的特性：</p>
<p>待写</p>
<h2 id="Session接口定义"><a href="#Session接口定义" class="headerlink" title="Session接口定义"></a>Session接口定义</h2><p>Shiro提供的Session和Servlet中的Session其实是一样的作用，只是Shiro中的Sesion不需要再依赖于WEB容器存在。下面是Session接口提供的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 返回表示Session的唯一ID</span><br><span class="line"> */</span><br><span class="line">Serializable getId();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 返回Session的开始时间</span><br><span class="line"> */</span><br><span class="line">Date getStartTimestamp();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 返回最近使用的时间</span><br><span class="line"> */</span><br><span class="line">Date getLastAccessTime();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 返回还有多久Session过期(毫秒)</span><br><span class="line"> */</span><br><span class="line">long getTimeout() throws InvalidSessionException;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 设置超时时间(毫秒)</span><br><span class="line"> */</span><br><span class="line">void setTimeout(long maxIdleTimeInMillis) throws InvalidSessionException;    </span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 返回Session创建时的主机名或地址</span><br><span class="line"> */</span><br><span class="line">String getHost();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 更新最近访问时间，确保Session不会过期</span><br><span class="line"> */</span><br><span class="line">void touch() throws InvalidSessionException;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 设置Session停止使用，并释放相关资源</span><br><span class="line"> */</span><br><span class="line">void stop() throws InvalidSessionException;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 返回该Session存储的所有属性键</span><br><span class="line"> */</span><br><span class="line">Collection&lt;Object&gt; getAttributeKeys() throws InvalidSessionException;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 获取Session属性</span><br><span class="line"> */</span><br><span class="line">Object getAttribute(Object key) throws InvalidSessionException;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 设置Session属性</span><br><span class="line"> */</span><br><span class="line">void setAttribute(Object key, Object value) throws InvalidSessionException;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 删除Session属性</span><br><span class="line"> */</span><br><span class="line">Object removeAttribute(Object key) throws InvalidSessionException;</span><br></pre></td></tr></table></figure>

<p>从接口中我们可以看出。Session有一个唯一ID，开始时间，最近活动时间等属性，另外提供了两个相对应的方法touch()和stop()，其他方法就是对属性的操作了。Session接口还是相当简单清晰的，下面我们看看接口的实现类。</p>
<p>Session有一些实现类，包括SimpleSession、HttpServletSession和DelegatingSession等。SimpleSession是Shiro提供的一种简单实现，HttpServletSession是基于Sevlet中Session来实现的，DelegatingSession是一种委托机制，委托给SessionManager来实现。下面，我们主要以SimpleSession和DelegatingSession来分析。</p>
<h2 id="SimpleSession实现"><a href="#SimpleSession实现" class="headerlink" title="SimpleSession实现"></a>SimpleSession实现</h2><p>SimpleSession从Session接口继承过来的方法实现非常简单，就不过多分析了。我们主要分析一下属性，通过属性就可以了解到SimpleSession中功能的实现了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// Session唯一ID</span><br><span class="line">private transient Serializable id;</span><br><span class="line">// 开始时间</span><br><span class="line">private transient Date startTimestamp;</span><br><span class="line">// 结束时间</span><br><span class="line">private transient Date stopTimestamp;</span><br><span class="line">// 最近访问时间</span><br><span class="line">private transient Date lastAccessTime;</span><br><span class="line">// 还有多久过期</span><br><span class="line">private transient long timeout;</span><br><span class="line">// 是否过期</span><br><span class="line">private transient boolean expired;</span><br><span class="line">// Session创建时的主机名</span><br><span class="line">private transient String host;</span><br><span class="line">// Session存储的属性值</span><br><span class="line">private transient Map&lt;Object, Object&gt; attributes;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://lancersaber.github.io/2020/05/23/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/shiro/Shiro%E5%8E%9F%E7%A0%81%E5%88%86%E6%9E%90(1)-Shiro%E5%BC%80%E7%AF%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lancersaber">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lancersaber">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/23/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/shiro/Shiro%E5%8E%9F%E7%A0%81%E5%88%86%E6%9E%90(1)-Shiro%E5%BC%80%E7%AF%87/" class="post-title-link" itemprop="url">Shiro源码分析(1)-Shiro开篇</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-23 15:58:34" itemprop="dateCreated datePublished" datetime="2020-05-23T15:58:34+08:00">2020-05-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-25 23:55:49" itemprop="dateModified" datetime="2020-05-25T23:55:49+08:00">2020-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/sourceread/" itemprop="url" rel="index">
                    <span itemprop="name">sourceread</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Shiro源码分析-1-Shiro开篇"><a href="#Shiro源码分析-1-Shiro开篇" class="headerlink" title="Shiro源码分析(1)-Shiro开篇"></a>Shiro源码分析(1)-Shiro开篇</h1><hr>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a><strong><code>简介</code></strong></h2><ul>
<li>SecurityManager：安全管理器，Shiro最核心组件。Shiro通过SecurityManager来管理内部组件实例，并通过它来提供安全管理的各种服务。</li>
<li>Authenticator：认证器，认证AuthenticationToken是否有效。</li>
<li>Authorizer：授权器，处理角色和权限。</li>
<li>SessionManager：Session管理器，管理Session。</li>
<li>Subject：当前操作主体，表示当前操作用户。</li>
<li>SubjectContext：Subject上下文数据对象。</li>
<li>AuthenticationToken：认证的token信息(用户名、密码等)。</li>
<li>ThreadContext：线程上下文对象，负责绑定对象到当前线程。</li>
</ul>
<p>在学习和使用Shiro过程中，我们都知道SecurityManager接口在Shiro中是最为核心的接口。我们就沿着这个接口进行分析。</p>
<p>下面的代码是SecurityManager接口的定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public interface SecurityManager extends Authenticator, Authorizer, SessionManager &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 登录</span><br><span class="line">     */</span><br><span class="line">    Subject login(Subject subject, AuthenticationToken authenticationToken) throws AuthenticationException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 登出</span><br><span class="line">     */</span><br><span class="line">    void logout(Subject subject);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 创建Subject</span><br><span class="line">     */</span><br><span class="line">    Subject createSubject(SubjectContext context);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在SecurityManager 中定义了三个方法，分别是登录、登出和创建Subject。通常我们在使用的时候是这样使用的。首先创建Subject对象，然后通过调用login方法传入认证信息token对登录进行认证。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Subject subject = SecurityUtils.getSubject();</span><br><span class="line">UsernamePasswordToken token = new UsernamePasswordToken(&quot;zhang&quot;, &quot;123&quot;);</span><br><span class="line">subject.login(token);</span><br></pre></td></tr></table></figure>

<h2 id="SecurityUtils分析"><a href="#SecurityUtils分析" class="headerlink" title="SecurityUtils分析"></a><strong><code>SecurityUtils分析</code></strong></h2><p>在Shiro中提供了一个方便使用的工具类SecurityUtils，SecurityUtils核心功能是获取SecurityManager以及Subject。这两个接口是Shiro提供的外围接口，供开发时使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public abstract class SecurityUtils &#123;</span><br><span class="line"></span><br><span class="line">    private static SecurityManager securityManager;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>###1. <strong><code>获取SecurityManager</code></strong></p>
<p>首先从ThreadContext中获取，如果没有，则从SecurityUtils属性securityManager中获取。一定要存在一个SecurityManager实例对象，否则抛异常。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public <span class="keyword">static</span> SecurityManager getSecurityManager() throws UnavailableSecurityManagerException &#123;</span><br><span class="line">       SecurityManager securityManager = ThreadContext.getSecurityManager();</span><br><span class="line">       <span class="keyword">if</span> (securityManager == <span class="literal">null</span>) &#123;</span><br><span class="line">           securityManager = SecurityUtils.securityManager;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (securityManager == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="built_in">String</span> msg = <span class="string">"No SecurityManager accessible to the calling code, either bound to the "</span> +</span><br><span class="line">                   ThreadContext.class.getName() + <span class="string">" or as a vm static singleton.  This is an invalid application "</span> +</span><br><span class="line">                   <span class="string">"configuration."</span>;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> UnavailableSecurityManagerException(msg);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> securityManager;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>###2. 获取Subject</p>
<p>首先从ThreadContext中获取，如果不存在，则创建新的Subject，再存放到ThreadContext中，以便下次可以获取。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public static Subject getSubject() &#123;</span><br><span class="line">	Subject subject = ThreadContext.getSubject();</span><br><span class="line">	if (subject == null) &#123;</span><br><span class="line">		subject = (new Subject.Builder()).buildSubject();</span><br><span class="line">		ThreadContext.bind(subject);</span><br><span class="line">	&#125;</span><br><span class="line">	return subject;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://lancersaber.github.io/2020/05/23/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/jdk/ArrayList%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lancersaber">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lancersaber">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/23/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/jdk/ArrayList%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">ArrayList源码分析</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-23 10:25:53" itemprop="dateCreated datePublished" datetime="2020-05-23T10:25:53+08:00">2020-05-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-25 23:55:50" itemprop="dateModified" datetime="2020-05-25T23:55:50+08:00">2020-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/sourceread/" itemprop="url" rel="index">
                    <span itemprop="name">sourceread</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ArrayList源码分析"><a href="#ArrayList源码分析" class="headerlink" title="ArrayList源码分析"></a><em>ArrayList源码分析</em></h1><hr>
<h6 id="简介"><a href="#简介" class="headerlink" title="简介"></a><strong><code>简介</code></strong></h6><p>ArrayList是一种以数组实现的List，与数组相比，它具有动态扩展的能力，因此也可称之为动态数组。</p>
<h6 id="继承体系"><a href="#继承体系" class="headerlink" title="继承体系"></a><strong><code>继承体系</code></strong></h6><p><img src="https://i.loli.net/2020/05/23/x5GdFIzicShLUZM.png" alt="ArrayList.png"><br>ArrayList实现了List, RandomAccess, Cloneable, java.io.Serializable等接口。<br>ArrayList实现了List，提供了基础的添加、删除、遍历等操作。<br>ArrayList实现了RandomAccess，提供了随机访问的能力。<br>ArrayList实现了Cloneable，可以被克隆。<br>ArrayList实现了Serializable，可以被序列化。</p>
<h6 id="源码解析"><a href="#源码解析" class="headerlink" title="源码解析"></a><em><code>源码解析</code></em></h6><p><strong><code>属性</code></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 默认容量</span><br><span class="line"> */</span><br><span class="line">private static final int DEFAULT_CAPACITY = 10;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 空数组，如果传入的容量为0时使用</span><br><span class="line"> */</span><br><span class="line">private static final Object[] EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 空数组，未传入容量时使用，添加第一个元素的时候会重新初始为默认容量大小</span><br><span class="line"> */</span><br><span class="line">private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 存储元素的数组</span><br><span class="line"> */</span><br><span class="line">transient Object[] elementData; // non-private to simplify nested class access</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 集合中元素的个数</span><br><span class="line"> */</span><br><span class="line">private int size;</span><br></pre></td></tr></table></figure>
<p>（1）DEFAULT_CAPACITY<br>默认容量为10，也就是通过new ArrayList()创建时的默认容量。</p>
<p>（2）EMPTY_ELEMENTDATA<br>空的数组，这种是通过new ArrayList(0)创建时用的是这个空数组。</p>
<p>（3）DEFAULTCAPACITY_EMPTY_ELEMENTDATA<br>也是空数组，这种是通过new ArrayList()创建时用的是这个空数组，与EMPTY_ELEMENTDATA的区别是在添加第一个元素时使用这个空数组的会初始化为DEFAULT_CAPACITY（10）个元素。</p>
<p>（4）elementData<br>真正存放元素的地方，使用transient是为了不序列化这个字段。<br>至于没有使用private修饰，后面注释是写的“为了简化嵌套类的访问”，但是楼主实测加了private嵌套类一样可以访问。<br>private表示是类私有的属性，只要是在这个类内部都可以访问，嵌套类或者内部类也是在类的内部，所以也可以访问类的私有成员。</p>
<p>（5）size<br>真正存储元素的个数，而不是elementData数组的长度。</p>
<p><strong><code>ArrayList(int initialCapacity)构造方法</code></strong><br>传入初始容量，如果大于0就初始化elementData为对应大小，如果等于0就使用EMPTY_ELEMENTDATA空数组，如果小于0抛出异常。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public ArrayList(int initialCapacity) &#123;</span><br><span class="line">    if (initialCapacity &gt; 0) &#123;</span><br><span class="line">        // 如果传入的初始容量大于0，就新建一个数组存储元素</span><br><span class="line">        this.elementData = new Object[initialCapacity];</span><br><span class="line">    &#125; else if (initialCapacity == 0) &#123;</span><br><span class="line">        // 如果传入的初始容量等于0，使用空数组EMPTY_ELEMENTDATA</span><br><span class="line">        this.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // 如果传入的初始容量小于0，抛出异常</span><br><span class="line">        throw new IllegalArgumentException(&quot;Illegal Capacity: &quot; + initialCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><code>ArrayList()构造方法</code></strong><br>不传初始容量，初始化为DEFAULTCAPACITY_EMPTY_ELEMENTDATA空数组，会在添加第一个元素的时候扩容为默认的大小，即10。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public ArrayList() &#123;</span><br><span class="line">    // 如果没有传入初始容量，则使用空数组DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><br><span class="line">    // 使用这个数组是在添加第一个元素的时候会扩容到默认大小10</span><br><span class="line">    this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><code>ArrayList 构造方法</code></strong><br>传入集合并初始化elementData，这里会使用拷贝把传入集合的元素拷贝到elementData数组中，如果元素个数为0，则初始化为EMPTY_ELEMENTDATA空数组。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 把传入集合的元素初始化到ArrayList中</span><br><span class="line">*/</span><br><span class="line">public ArrayList(Collection&lt;? extends E&gt; c) &#123;</span><br><span class="line">    // 集合转数组</span><br><span class="line">    elementData = c.toArray();</span><br><span class="line">    if ((size = elementData.length) != 0) &#123;</span><br><span class="line">        // 检查c.toArray()返回的是不是Object[]类型，如果不是，重新拷贝成Object[].class类型</span><br><span class="line">        if (elementData.getClass() != Object[].class)</span><br><span class="line">            elementData = Arrays.copyOf(elementData, size, Object[].class);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // 如果c的空集合，则初始化为空数组EMPTY_ELEMENTDATA</span><br><span class="line">        this.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><code>add(E e)方法</code></strong><br>添加元素到末尾，平均时间复杂度为O(1)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">public boolean add(E e) &#123;</span><br><span class="line">    // 检查是否需要扩容</span><br><span class="line">    ensureCapacityInternal(size + 1);</span><br><span class="line">    // 把元素插入到最后一位</span><br><span class="line">    elementData[size++] = e;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void ensureCapacityInternal(int minCapacity) &#123;</span><br><span class="line">    ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private static int calculateCapacity(Object[] elementData, int minCapacity) &#123;</span><br><span class="line">    // 如果是空数组DEFAULTCAPACITY_EMPTY_ELEMENTDATA，就初始化为默认大小10</span><br><span class="line">    if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">        return Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">    return minCapacity;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void ensureExplicitCapacity(int minCapacity) &#123;</span><br><span class="line">    modCount++;</span><br><span class="line"></span><br><span class="line">    if (minCapacity - elementData.length &gt; 0)</span><br><span class="line">        // 扩容</span><br><span class="line">        grow(minCapacity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void grow(int minCapacity) &#123;</span><br><span class="line">    int oldCapacity = elementData.length;</span><br><span class="line">    // 新容量为旧容量的1.5倍</span><br><span class="line">    int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1);</span><br><span class="line">    // 如果新容量发现比需要的容量还小，则以需要的容量为准</span><br><span class="line">    if (newCapacity - minCapacity &lt; 0)</span><br><span class="line">        newCapacity = minCapacity;</span><br><span class="line">    // 如果新容量已经超过最大容量了，则使用最大容量</span><br><span class="line">    if (newCapacity - MAX_ARRAY_SIZE &gt; 0)</span><br><span class="line">        newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">    // 以新容量拷贝出来一个新数组</span><br><span class="line">    elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（1）检查是否需要扩容；</p>
<p>（2）如果elementData等于DEFAULTCAPACITY_EMPTY_ELEMENTDATA则初始化容量大小为DEFAULT_CAPACITY；</p>
<p>（3）新容量是老容量的1.5倍（oldCapacity + (oldCapacity &gt;&gt; 1)），如果加了这么多容量发现比需要的容量还小，则以需要的容量为准；</p>
<p>（4）创建新容量的数组并把老数组拷贝到新数组；</p>
<p><strong><code>add(int index, E element)方法</code></strong><br>添加元素到指定位置，平均时间复杂度为O(n)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public void add(int index, E element) &#123;</span><br><span class="line">    // 检查是否越界</span><br><span class="line">    rangeCheckForAdd(index);</span><br><span class="line">    // 检查是否需要扩容</span><br><span class="line">    ensureCapacityInternal(size + 1);</span><br><span class="line">    // 将inex及其之后的元素往后挪一位，则index位置处就空出来了</span><br><span class="line">    System.arraycopy(elementData, index, elementData, index + 1,</span><br><span class="line">                     size - index);</span><br><span class="line">    // 将元素插入到index的位置</span><br><span class="line">    elementData[index] = element;</span><br><span class="line">    // 大小增1</span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void rangeCheckForAdd(int index) &#123;</span><br><span class="line">    if (index &gt; size || index &lt; 0)</span><br><span class="line">        throw new IndexOutOfBoundsException(outOfBoundsMsg(index));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（1）检查索引是否越界；</p>
<p>（2）检查是否需要扩容；</p>
<p>（3）把插入索引位置后的元素都往后挪一位；</p>
<p>（4）在插入索引位置放置插入的元素；</p>
<p>（5）大小加1；</p>
<p><strong><code>addAll 方法</code></strong></p>
<p>求两个集合的并集。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 将集合c中所有元素添加到当前ArrayList中</span><br><span class="line">*/</span><br><span class="line">public boolean addAll(Collection&lt;? extends E&gt; c) &#123;</span><br><span class="line">    // 将集合c转为数组</span><br><span class="line">    Object[] a = c.toArray();</span><br><span class="line">    int numNew = a.length;</span><br><span class="line">    // 检查是否需要扩容</span><br><span class="line">    ensureCapacityInternal(size + numNew);</span><br><span class="line">    // 将c中元素全部拷贝到数组的最后</span><br><span class="line">    System.arraycopy(a, 0, elementData, size, numNew);</span><br><span class="line">    // 大小增加c的大小</span><br><span class="line">    size += numNew;</span><br><span class="line">    // 如果c不为空就返回true，否则返回false</span><br><span class="line">    return numNew != 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（1）拷贝c中的元素到数组a中；</p>
<p>（2）检查是否需要扩容；</p>
<p>（3）把数组a中的元素拷贝到elementData的尾部；</p>
<p><strong><code>get(int index)方法</code></strong></p>
<p>获取指定索引位置的元素，时间复杂度为O(1)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public E get(int index) &#123;</span><br><span class="line">    // 检查是否越界</span><br><span class="line">    rangeCheck(index);</span><br><span class="line">    // 返回数组index位置的元素</span><br><span class="line">    return elementData(index);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void rangeCheck(int index) &#123;</span><br><span class="line">    if (index &gt;= size)</span><br><span class="line">        throw new IndexOutOfBoundsException(outOfBoundsMsg(index));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">E elementData(int index) &#123;</span><br><span class="line">    return (E) elementData[index];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（1）检查索引是否越界，这里只检查是否越上界，如果越上界抛出IndexOutOfBoundsException异常，如果越下界抛出的是ArrayIndexOutOfBoundsException异常。</p>
<p>（2）返回索引位置处的元素；</p>
<p><strong><code>remove(int index)方法</code></strong></p>
<p>删除指定索引位置的元素，时间复杂度为O(n)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public E remove(int index) &#123;</span><br><span class="line">    // 检查是否越界</span><br><span class="line">    rangeCheck(index);</span><br><span class="line"></span><br><span class="line">    modCount++;</span><br><span class="line">    // 获取index位置的元素</span><br><span class="line">    E oldValue = elementData(index);</span><br><span class="line"></span><br><span class="line">    // 如果index不是最后一位，则将index之后的元素往前挪一位</span><br><span class="line">    int numMoved = size - index - 1;</span><br><span class="line">    if (numMoved &gt; 0)</span><br><span class="line">        System.arraycopy(elementData, index+1, elementData, index, numMoved);</span><br><span class="line"></span><br><span class="line">    // 将最后一个元素删除，帮助GC</span><br><span class="line">    elementData[--size] = null; // clear to let GC do its work</span><br><span class="line"></span><br><span class="line">    // 返回旧值</span><br><span class="line">    return oldValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（1）检查索引是否越界；</p>
<p>（2）获取指定索引位置的元素；</p>
<p>（3）如果删除的不是最后一位，则其它元素往前移一位；</p>
<p>（4）将最后一位置为null，方便GC回收；</p>
<p>（5）返回删除的元素。</p>
<p><em>可以看到，ArrayList删除元素的时候并没有缩容。</em></p>
<p><strong><code>remove(Object o)方法</code></strong></p>
<p>删除指定元素值的元素，时间复杂度为O(n)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public boolean remove(Object o) &#123;</span><br><span class="line">    if (o == null) &#123;</span><br><span class="line">        // 遍历整个数组，找到元素第一次出现的位置，并将其快速删除</span><br><span class="line">        for (int index = 0; index &lt; size; index++)</span><br><span class="line">            // 如果要删除的元素为null，则以null进行比较，使用==</span><br><span class="line">            if (elementData[index] == null) &#123;</span><br><span class="line">                fastRemove(index);</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // 遍历整个数组，找到元素第一次出现的位置，并将其快速删除</span><br><span class="line">        for (int index = 0; index &lt; size; index++)</span><br><span class="line">            // 如果要删除的元素不为null，则进行比较，使用equals()方法</span><br><span class="line">            if (o.equals(elementData[index])) &#123;</span><br><span class="line">                fastRemove(index);</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void fastRemove(int index) &#123;</span><br><span class="line">    // 少了一个越界的检查</span><br><span class="line">    modCount++;</span><br><span class="line">    // 如果index不是最后一位，则将index之后的元素往前挪一位</span><br><span class="line">    int numMoved = size - index - 1;</span><br><span class="line">    if (numMoved &gt; 0)</span><br><span class="line">        System.arraycopy(elementData, index+1, elementData, index, numMoved);</span><br><span class="line">    // 将最后一个元素删除，帮助GC</span><br><span class="line">    elementData[--size] = null; // clear to let GC do its work</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（1）找到第一个等于指定元素值的元素；</p>
<p>（2）快速删除；<br><em>fastRemove(int index)相对于remove(int index)少了检查索引越界的操作，可见jdk将性能优化到极致。</em></p>
<p><strong><em><code>retainAll方法</code></em></strong></p>
<p>求两个集合的交集。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">public boolean retainAll(Collection&lt;?&gt; c) &#123;</span><br><span class="line">    // 集合c不能为null</span><br><span class="line">    Objects.requireNonNull(c);</span><br><span class="line">    // 调用批量删除方法，这时complement传入true，表示删除不包含在c中的元素</span><br><span class="line">    return batchRemove(c, true);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* 批量删除元素</span><br><span class="line">* complement为true表示删除c中不包含的元素</span><br><span class="line">* complement为false表示删除c中包含的元素</span><br><span class="line">*/</span><br><span class="line">private boolean batchRemove(Collection&lt;?&gt; c, boolean complement) &#123;</span><br><span class="line">    final Object[] elementData = this.elementData;</span><br><span class="line">    // 使用读写两个指针同时遍历数组</span><br><span class="line">    // 读指针每次自增1，写指针放入元素的时候才加1</span><br><span class="line">    // 这样不需要额外的空间，只需要在原有的数组上操作就可以了</span><br><span class="line">    int r = 0, w = 0;</span><br><span class="line">    boolean modified = false;</span><br><span class="line">    try &#123;</span><br><span class="line">        // 遍历整个数组，如果c中包含该元素，则把该元素放到写指针的位置（以complement为准）</span><br><span class="line">        for (; r &lt; size; r++)</span><br><span class="line">            if (c.contains(elementData[r]) == complement)</span><br><span class="line">                elementData[w++] = elementData[r];</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        // 正常来说r最后是等于size的，除非c.contains()抛出了异常</span><br><span class="line">        if (r != size) &#123;</span><br><span class="line">            // 如果c.contains()抛出了异常，则把未读的元素都拷贝到写指针之后</span><br><span class="line">            System.arraycopy(elementData, r,</span><br><span class="line">                             elementData, w,</span><br><span class="line">                             size - r);</span><br><span class="line">            w += size - r;</span><br><span class="line">        &#125;</span><br><span class="line">        if (w != size) &#123;</span><br><span class="line">            // 将写指针之后的元素置为空，帮助GC</span><br><span class="line">            for (int i = w; i &lt; size; i++)</span><br><span class="line">                elementData[i] = null;</span><br><span class="line">            modCount += size - w;</span><br><span class="line">            // 新大小等于写指针的位置（因为每写一次写指针就加1，所以新大小正好等于写指针的位置）</span><br><span class="line">            size = w;</span><br><span class="line">            modified = true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // 有修改返回true</span><br><span class="line">    return modified;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（1）遍历elementData数组；</p>
<p>（2）如果元素在c中，则把这个元素添加到elementData数组的w位置并将w位置往后移一位；</p>
<p>（3）遍历完之后，w之前的元素都是两者共有的，w之后（包含）的元素不是两者共有的；</p>
<p>（4）将w之后（包含）的元素置为null，方便GC回收；</p>
<p><strong><em><code>removeAll</code></em></strong></p>
<p>求两个集合的单方向差集，只保留当前集合中不在c中的元素，不保留在c中不在当前集体中的元素。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public boolean removeAll(Collection&lt;?&gt; c) &#123;</span><br><span class="line">    // 集合c不能为空</span><br><span class="line">    Objects.requireNonNull(c);</span><br><span class="line">    // 同样调用批量删除方法，这时complement传入false，表示删除包含在c中的元素</span><br><span class="line">    return batchRemove(c, false);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>与retainAll(Collection&lt;?&gt; c)方法类似，只是这里保留的是不在c中的元素。</p>
<h6 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong><em><code>总结</code></em></strong></h6><p>（1）ArrayList内部使用数组存储元素，当数组长度不够时进行扩容，每次加一半的空间，ArrayList不会进行缩容；</p>
<p>（2）ArrayList支持随机访问，通过索引访问元素极快，时间复杂度为O(1)；</p>
<p>（3）ArrayList添加元素到尾部极快，平均时间复杂度为O(1)；</p>
<p>（4）ArrayList添加元素到中间比较慢，因为要搬移元素，平均时间复杂度为O(n)；</p>
<p>（5）ArrayList从尾部删除元素极快，时间复杂度为O(1)；</p>
<p>（6）ArrayList从中间删除元素比较慢，因为要搬移元素，平均时间复杂度为O(n)；</p>
<p>（7）ArrayList支持求并集，调用addAll(Collection&lt;? extends E&gt; c)方法即可；</p>
<p>（8）ArrayList支持求交集，调用retainAll(Collection&lt;? extends E&gt; c)方法即可；</p>
<p>（7）ArrayList支持求单向差集，调用removeAll(Collection&lt;? extends E&gt; c)方法即可；</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://lancersaber.github.io/2020/05/22/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/jdk/LinkedList%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lancersaber">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lancersaber">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/22/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/jdk/LinkedList%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">LinkedList源码分析</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-22 19:03:16" itemprop="dateCreated datePublished" datetime="2020-05-22T19:03:16+08:00">2020-05-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-25 23:52:38" itemprop="dateModified" datetime="2020-05-25T23:52:38+08:00">2020-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/sourceread/" itemprop="url" rel="index">
                    <span itemprop="name">sourceread</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="LinkedList源码分析"><a href="#LinkedList源码分析" class="headerlink" title="LinkedList源码分析"></a>LinkedList源码分析</h1><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ol>
<li>LinkedList只是一个List吗？</li>
<li>LinkedList还有其它什么特性吗？</li>
<li>LinkedList为啥经常拿出来跟ArrayList比较？</li>
</ol>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>LinkedList是一个以双向链表实现的list，它除了作为list使用，还可以作为队列或栈来使用。</p>
<h2 id="继承体系"><a href="#继承体系" class="headerlink" title="继承体系"></a>继承体系</h2><p><img src="https://i.loli.net/2020/05/22/oBAwRi9CDHyqJEs.png" alt="LinkedList.png"><br>通过继承体系，我们可以看到LinkedList不仅实现了List接口，还实现了Queue和Deque接口，所以它既能作为List使用，也能作为双端队列使用，当然也可以作为栈使用。</p>
<h2 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h2><p><strong>主要属性</strong><br><img src="https://i.loli.net/2020/05/22/Nftk3GcHQJ1XyY2.png" alt="image.png"><br>属性很简单，定义了元素个数size和链表的首尾节点。</p>
<p><strong>主要内部类</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">private static class Node&lt;E&gt; &#123;</span><br><span class="line">    E item;</span><br><span class="line">    Node&lt;E&gt; next;</span><br><span class="line">    Node&lt;E&gt; prev;</span><br><span class="line"></span><br><span class="line">    Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123;</span><br><span class="line">        this.item = element;</span><br><span class="line">        this.next = next;</span><br><span class="line">        this.prev = prev;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>主要构造方法</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public LinkedList() &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public LinkedList(Collection&lt;? extends E&gt; c) &#123;</span><br><span class="line">    this();</span><br><span class="line">    addAll(c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>两个构造方法也很简单，可以看出是一个无界的队列。</p>
<p><strong>添加元素</strong><br>作为一个双端队列，添加元素主要有两种，一种是在队列尾部添加元素，一种是在队列首部添加元素，这两种形式在LinkedList中主要是通过下面两个方法来实现的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">public void addFirst(E e) &#123;</span><br><span class="line">    linkFirst(e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void addLast(E e) &#123;</span><br><span class="line">    linkLast(e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void linkFirst(E e) &#123;</span><br><span class="line">    //保存首节点</span><br><span class="line">    final Node&lt;E&gt; f = first;</span><br><span class="line"></span><br><span class="line">    //创建新节点，新节点的next是null</span><br><span class="line">    final Node&lt;E&gt; newNode = new Node&lt;&gt;(null, e, f);</span><br><span class="line"></span><br><span class="line">    //将first指向newNode</span><br><span class="line">    first = newNode;</span><br><span class="line"></span><br><span class="line">    //如果整个链表为空，则首节点和尾节点都是newNode，否则将之前的首节点的前驱节点设置为新的首节点</span><br><span class="line">    if (f == null)</span><br><span class="line">        last = newNode;</span><br><span class="line">    else</span><br><span class="line">        f.prev = newNode;</span><br><span class="line">    size++;</span><br><span class="line">    //修改次数</span><br><span class="line">    modCount++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 从队列尾添加元素</span><br><span class="line">void linkLast(E e) &#123;</span><br><span class="line">    // 队列尾节点</span><br><span class="line">    final Node&lt;E&gt; l = last;</span><br><span class="line">    // 创建新节点，新节点的prev是尾节点</span><br><span class="line">    final Node&lt;E&gt; newNode = new Node&lt;&gt;(l, e, null);</span><br><span class="line">    // 让新节点成为新的尾节点</span><br><span class="line">    last = newNode;</span><br><span class="line">    // 判断是不是第一个添加的元素</span><br><span class="line">    // 如果是就把first也置为新节点</span><br><span class="line">    // 否则把原尾节点的next指针置为新节点</span><br><span class="line">    if (l == null)</span><br><span class="line">        first = newNode;</span><br><span class="line">    else</span><br><span class="line">        l.next = newNode;</span><br><span class="line">    // 元素个数加1</span><br><span class="line">    size++;</span><br><span class="line">    // 修改次数加1</span><br><span class="line">    modCount++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 作为无界队列，添加元素总是会成功的</span><br><span class="line">public boolean offerFirst(E e) &#123;</span><br><span class="line">    addFirst(e);</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public boolean offerLast(E e) &#123;</span><br><span class="line">    addLast(e);</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>典型的双链表在首尾添加元素的方法，代码比较简单，这里不作详细描述了。</p>
<p>上面是作为双端队列来看，它的添加元素分为首尾添加元素，那么，作为List呢？</p>
<p>作为List，是要支持在中间添加元素的，主要是通过下面这个方法实现的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">// 在节点succ之前添加元素</span><br><span class="line">void linkBefore(E e, Node&lt;E&gt; succ) &#123;</span><br><span class="line">    // succ是待添加节点的后继节点</span><br><span class="line">    // 找到待添加节点的前置节点</span><br><span class="line">    final Node&lt;E&gt; pred = succ.prev;</span><br><span class="line">    // 在其前置节点和后继节点之间创建一个新节点</span><br><span class="line">    final Node&lt;E&gt; newNode = new Node&lt;&gt;(pred, e, succ);</span><br><span class="line">    // 修改后继节点的前置指针指向新节点</span><br><span class="line">    succ.prev = newNode;</span><br><span class="line">    // 判断前置节点是否为空</span><br><span class="line">    // 如果为空，说明是第一个添加的元素，修改first指针</span><br><span class="line">    // 否则修改前置节点的next为新节点</span><br><span class="line">    if (pred == null)</span><br><span class="line">        first = newNode;</span><br><span class="line">    else</span><br><span class="line">        pred.next = newNode;</span><br><span class="line">    // 修改元素个数</span><br><span class="line">    size++;</span><br><span class="line">    // 修改次数加1</span><br><span class="line">    modCount++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 寻找index位置的节点</span><br><span class="line">Node&lt;E&gt; node(int index) &#123;</span><br><span class="line">    // 因为是双链表</span><br><span class="line">    // 所以根据index是在前半段还是后半段决定从前遍历还是从后遍历</span><br><span class="line">    // 这样index在后半段的时候可以少遍历一半的元素</span><br><span class="line">    if (index &lt; (size &gt;&gt; 1)) &#123;</span><br><span class="line">        // 如果是在前半段</span><br><span class="line">        // 就从前遍历</span><br><span class="line">        Node&lt;E&gt; x = first;</span><br><span class="line">        for (int i = 0; i &lt; index; i++)</span><br><span class="line">            x = x.next;</span><br><span class="line">        return x;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // 如果是在后半段</span><br><span class="line">        // 就从后遍历</span><br><span class="line">        Node&lt;E&gt; x = last;</span><br><span class="line">        for (int i = size - 1; i &gt; index; i--)</span><br><span class="line">            x = x.prev;</span><br><span class="line">        return x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 在指定index位置处添加元素</span><br><span class="line">public void add(int index, E element) &#123;</span><br><span class="line">    // 判断是否越界</span><br><span class="line">    checkPositionIndex(index);</span><br><span class="line">    // 如果index是在队列尾节点之后的一个位置</span><br><span class="line">    // 把新节点直接添加到尾节点之后</span><br><span class="line">    // 否则调用linkBefore()方法在中间添加节点</span><br><span class="line">    if (index == size)</span><br><span class="line">        linkLast(element);</span><br><span class="line">    else</span><br><span class="line">        linkBefore(element, node(index));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在中间添加元素的方法也很简单，典型的双链表在中间添加元素的方法。</p>
<p>在队列首尾添加元素很高效，时间复杂度为O(1)。</p>
<p>在中间添加元素比较低效，首先要先找到插入位置的节点，再修改前后节点的指针，时间复杂度为O(n)。</p>
<p><strong>删除元素</strong><br>作为双端队列，删除元素也有两种方式，一种是队列首删除元素，一种是队列尾删除元素。</p>
<p>作为List，又要支持中间删除元素，所以删除元素一个有三个方法，分别如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">//删除链表的首节点</span><br><span class="line">private E unlinkFirst(Node&lt;E&gt; f) &#123;</span><br><span class="line">    // assert f == first &amp;&amp; f != null;</span><br><span class="line">    //获得首节点的值</span><br><span class="line">    final E element = f.item;</span><br><span class="line">    //获得首节点的下一个节点</span><br><span class="line">    final Node&lt;E&gt; next = f.next;</span><br><span class="line">    //将f所引用的指针全部置空，防止内存泄漏</span><br><span class="line">    f.item = null;</span><br><span class="line">    f.next = null; // help GC</span><br><span class="line">    </span><br><span class="line">    //将first指向next，成功删除next</span><br><span class="line">    first = next;</span><br><span class="line">    </span><br><span class="line">    //根据next是否为空来进行处理</span><br><span class="line">    if (next == null)</span><br><span class="line">        last = null;</span><br><span class="line">    else</span><br><span class="line">        next.prev = null;</span><br><span class="line">    </span><br><span class="line">    size--;</span><br><span class="line">    modCount++;</span><br><span class="line">    return element;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//删除链表的尾节点</span><br><span class="line">private E unlinkLast(Node&lt;E&gt; l) &#123;</span><br><span class="line">    // assert l == last &amp;&amp; l != null;</span><br><span class="line">    final E element = l.item;</span><br><span class="line">    final Node&lt;E&gt; prev = l.prev;</span><br><span class="line">    l.item = null;</span><br><span class="line">    l.prev = null; // help GC</span><br><span class="line">    last = prev;</span><br><span class="line">    if (prev == null)</span><br><span class="line">        first = null;</span><br><span class="line">    else</span><br><span class="line">        prev.next = null;</span><br><span class="line">    size--;</span><br><span class="line">    modCount++;</span><br><span class="line">    return element;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 删除指定节点x</span><br><span class="line">E unlink(Node&lt;E&gt; x) &#123;</span><br><span class="line">    // x的元素值</span><br><span class="line">    final E element = x.item;</span><br><span class="line">    // x的前置节点</span><br><span class="line">    final Node&lt;E&gt; next = x.next;</span><br><span class="line">    // x的后置节点</span><br><span class="line">    final Node&lt;E&gt; prev = x.prev;</span><br><span class="line"></span><br><span class="line">    // 如果前置节点为空</span><br><span class="line">    // 说明是首节点，让first指向x的后置节点</span><br><span class="line">    // 否则修改前置节点的next为x的后置节点</span><br><span class="line">    if (prev == null) &#123;</span><br><span class="line">        first = next;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        prev.next = next;</span><br><span class="line">        x.prev = null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 如果后置节点为空</span><br><span class="line">    // 说明是尾节点，让last指向x的前置节点</span><br><span class="line">    // 否则修改后置节点的prev为x的前置节点</span><br><span class="line">    if (next == null) &#123;</span><br><span class="line">        last = prev;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        next.prev = prev;</span><br><span class="line">        x.next = null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 清空x的元素值，协助GC</span><br><span class="line">    x.item = null;</span><br><span class="line">    // 元素个数减1</span><br><span class="line">    size--;</span><br><span class="line">    // 修改次数加1</span><br><span class="line">    modCount++;</span><br><span class="line">    // 返回删除的元素</span><br><span class="line">    return element;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="LinkedList作为栈使用"><a href="#LinkedList作为栈使用" class="headerlink" title="LinkedList作为栈使用"></a>LinkedList作为栈使用</h2><p>前面我们说了，LinkedList是双端队列，还记得双端队列可以作为栈使用吗？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public void push(E e) &#123;</span><br><span class="line">    addFirst(e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public E pop() &#123;</span><br><span class="line">    return removeFirst();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>栈的特性是LIFO(Last In First Out)，所以作为栈使用也很简单，添加删除元素都只操作队列首节点即可。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>（1）LinkedList是一个以双链表实现的List；</p>
<p>（2）LinkedList还是一个双端队列，具有队列、双端队列、栈的特性；</p>
<p>（3）LinkedList在队列首尾添加、删除元素非常高效，时间复杂度为O(1)；</p>
<p>（4）LinkedList在中间添加、删除元素比较低效，时间复杂度为O(n)；</p>
<p>（5）LinkedList不支持随机访问，所以访问非队列首尾的元素比较低效；</p>
<p>（6）LinkedList在功能上等于ArrayList + ArrayDeque；</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://lancersaber.github.io/2020/05/22/Java%E5%9F%BA%E7%A1%80/Iterator%E6%8E%A5%E5%8F%A3%E5%92%8CIterable%E6%8E%A5%E5%8F%A3%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lancersaber">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lancersaber">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/22/Java%E5%9F%BA%E7%A1%80/Iterator%E6%8E%A5%E5%8F%A3%E5%92%8CIterable%E6%8E%A5%E5%8F%A3%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">Iterator接口和Iterable接口详解</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-05-22 17:31:29 / Modified: 18:04:11" itemprop="dateCreated datePublished" datetime="2020-05-22T17:31:29+08:00">2020-05-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Iterator接口和Iterable接口详解"><a href="#Iterator接口和Iterable接口详解" class="headerlink" title="Iterator接口和Iterable接口详解"></a>Iterator接口和Iterable接口详解</h1><p><strong>1. Iterator接口</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">迭代器（Iterator）主要用来操作java中的集合对象（Collection）,迭代器提供了统一的语法进行集合对象（Collection）遍历操作，</span><br><span class="line">无需关心集合对象内部的实现方式，java提供了一个迭代器接口Iterator，Iterator只能向前移，无法后退；</span><br></pre></td></tr></table></figure>
<p>iterator的声明如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public interface Iterator&lt;E&gt; &#123;</span><br><span class="line">    boolean hasNext();</span><br><span class="line">    E next();</span><br><span class="line">    void remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从上面的接口可以看到Iterator迭代器接口只提供了三个无参数的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hasNext --判断是否还有下一个对象，如果有，则返回true，否则false</span><br><span class="line">next --返回集合的下个值，此方法只能在hasNext方法返回true时调用</span><br><span class="line">remove --删除集合的当前值，此方法也只能在hasNext方法返回true时调用</span><br></pre></td></tr></table></figure>

<p>Iterable的源码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface Iterable&lt;T&gt; &#123;</span><br><span class="line">    Iterator&lt;T&gt; iterator();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在jdk1.8加入了forEach和spliterator方法。</p>
<p>在集合中由于Collection继承了Iterable接口，因此jdk中所有的集合类都可以调用iterator()方法来获取到iterator实例，从而来对集合进行遍历。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public interface Collection&lt;E&gt; extends Iterable&lt;E&gt;</span><br></pre></td></tr></table></figure>

<p><strong>Iterable和Iterator的区别</strong><br>可以这样理解，只要实现Iterable接口就具备了迭代遍历的能力，也就是能够取得Iterator实例的唯一途径。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://lancersaber.github.io/2020/05/22/JVM/%E6%96%B9%E6%B3%95%E5%8C%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lancersaber">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lancersaber">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/22/JVM/%E6%96%B9%E6%B3%95%E5%8C%BA/" class="post-title-link" itemprop="url">方法区</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-05-22 09:09:00 / Modified: 17:32:56" itemprop="dateCreated datePublished" datetime="2020-05-22T09:09:00+08:00">2020-05-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Jvm/" itemprop="url" rel="index">
                    <span itemprop="name">Jvm</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h1><hr>
<p>方法区，Method Area， 对于习惯在HotSpot虚拟机上开发和部署程序的开发者来说，很多人愿意把方法区称为“永久代”（Permanent Generation），在jdk1.8以后将永久代换成了元空间，本质上两者并不等价，仅仅是因为HotSpot虚拟机的设计团队选择把GC分代收集扩展至方法区，或者说使用永久代来实现方法区而已。对于其他虚拟机（如BEA JRockit、IBM J9等）来说是不存在永久代的概念的。方法区还有一个别名叫做Non-Heap(非堆)，目的就是要和堆分开。所以，<strong>方法区可以看作是一块独立于Java堆的内存空间</strong></p>
<p>主要存放已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据（比如spring 使用IOC或者AOP创建bean时，或者使用cglib，反射的形式动态生成class信息等）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注意：JDK 6 时，String等字符串常量的信息是置于方法区中的，但是到了JDK 7 时，已经移动到了Java堆。所以，方法区也好，Java堆也罢，到底详细的保存了什么，其实没有具体定论，要结合不同的JVM版本来分析。</span><br></pre></td></tr></table></figure>

<p>元空间的本质和永久代类似，都是对JVM规范中方法区的实现。不过元空间与永久代最大的区别在于：<strong>元空间不在虚拟机设置的内存中，而是使用本地内存</strong>。还有一个就是内部结构也发生了改变。</p>
<p><strong>方法区的基本理解</strong></p>
<ol>
<li>方法区与Java堆一样，是各个线程共享的内存区域</li>
<li>方法区在JVM启动的时候被创建，并且它的实际的物理内存空间和Java堆一样都可以是不连续的。</li>
<li>方法区的大小，跟堆空间一样，可以选择固定大小或者可扩展</li>
<li>方法区的大小决定了系统可以保存多少个类，如果系统定义了太多的类，导致方法区溢出，虚拟机同样会报内存溢出错误。</li>
<li>关闭jvm就会释放这个区域的内存。</li>
</ol>
<h2 id="设置方法区的大小"><a href="#设置方法区的大小" class="headerlink" title="设置方法区的大小"></a>设置方法区的大小</h2><p>jdk1.7及以前：</p>
<ul>
<li>通过-XX:PermSize=<size>来设置永久代初始分配空间。默认值是20.75m</li>
<li>-XX:MaxPermSize来设定永久代的最大可分配空间。32位机器默认64m，64位机器默认是82m</li>
</ul>
<p>jdk1.8及以后：</p>
<ul>
<li>-XX:MetaspaceSize和-XX:MaxMetaspaceSize指定，替代上面两个参数。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://lancersaber.github.io/2020/05/20/JVM/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lancersaber">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lancersaber">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/20/JVM/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" class="post-title-link" itemprop="url">垃圾回收</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-20 20:17:55" itemprop="dateCreated datePublished" datetime="2020-05-20T20:17:55+08:00">2020-05-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-22 17:33:14" itemprop="dateModified" datetime="2020-05-22T17:33:14+08:00">2020-05-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Jvm/" itemprop="url" rel="index">
                    <span itemprop="name">Jvm</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="垃圾回收"><a href="#垃圾回收" class="headerlink" title="垃圾回收"></a>垃圾回收</h1><hr>
<p><strong>什么是垃圾？</strong></p>
<ul>
<li>垃圾是指在<strong>运行程序中没有任何指针指向的对象，这个对象就是需要被回收的垃圾</strong></li>
</ul>
<p><strong>1、为什么需要GC</strong></p>
<ul>
<li>如果不进行垃圾回收，内存迟早都会消耗完，因为不断地分配内存空间而不进行回收</li>
<li>除了释放没用的对象，垃圾回收也可以清楚内存里的记录碎片。碎片整理将所占用的堆内存移到堆的一端，以便<strong>JVM将整理出的内存分配给新的对象</strong></li>
<li>没有GC就不能保证应用程序的正常进行</li>
</ul>
<h2 id="2、垃圾回收的过程"><a href="#2、垃圾回收的过程" class="headerlink" title="2、垃圾回收的过程"></a>2、垃圾回收的过程</h2><h3 id="2-1-垃圾标记阶段：对象存活判断"><a href="#2-1-垃圾标记阶段：对象存活判断" class="headerlink" title="2.1 垃圾标记阶段：对象存活判断"></a>2.1 垃圾标记阶段：对象存活判断</h3><p>在堆里存放着几乎所有的Java对象实例，在GC执行垃圾会后之前，首先<strong>需要区分出内存中哪些是存活对象，哪些是已经死亡的对象</strong>。只有被标记为已经死亡的对象，GC才会在执行垃圾回收时，释放掉其占用的内存空间，因此这个过程我们可以称为<strong>垃圾标记阶段</strong></p>
<p>那么在JVM中究竟是如何标记一个对象的死亡的？简单来说，当一个对象已经不再被任何的存活对象继续引用，就可以宣判其为已经死亡。</p>
<p>判断对象存活一般有两种方式：<strong>引用计数算法</strong>和<strong>可达性分析算法</strong></p>
<h4 id="2-1-1引用计数算法"><a href="#2-1-1引用计数算法" class="headerlink" title="2.1.1引用计数算法"></a>2.1.1引用计数算法</h4><p>引用计数算法(Reference Counting)比较简单，<strong>对每个对象保存一个整型的引用计数器属性，用于记录对象被引用的情况</strong>。<br>对于一个对象A，只要有任何对象引用了A，则A的引用计数器就加1；当引用失效时，引用计数器就减1，只要对象A的引用计数器的值为0，即表示对象A不可能再被引用，可进行回收。</p>
<p><strong>优点：实现简单，垃圾对象便于辨识，判定效率高，回收没有延迟性</strong></p>
<p><strong>缺点</strong></p>
<ul>
<li>需要单独的字段存储计数器，增加存储空间的开销</li>
<li>每次赋值都需要更新计数器，伴随着加法和减法操作，增加了时间开销</li>
<li><strong>无法处理循环引用的情况</strong>，这是致命的缺陷，如下图所示。所以在Java中没有选择这种算法<br><img src="https://i.loli.net/2020/05/21/t9XVuEhldpMoTAG.png" alt="image.png"></li>
</ul>
<h4 id="2-1-2-可达性分析-或根搜索算法、追踪性垃圾收集算法"><a href="#2-1-2-可达性分析-或根搜索算法、追踪性垃圾收集算法" class="headerlink" title="2.1.2 可达性分析(或根搜索算法、追踪性垃圾收集算法)"></a>2.1.2 可达性分析(或根搜索算法、追踪性垃圾收集算法)</h4><p>相对于引用计数算法而言，可达性分析算法不仅同样具备实现简单和执行高效等特点，更重要的是该算法可以有效地<strong>解决在引用计数算法中循环引用的问题，防止内存泄漏的发生</strong>，这也是Java所选择的垃圾标记算法。</p>
<p>基本思路：</p>
<ol>
<li>可达性分析算法是以根对象集合(GC Roots)为起始点，按照从上至下的方式<strong>搜索被根对象集合所连接的目标对象是否可达。</strong></li>
<li>使用可达性分析算法后，内存中的存活对象都会被根对象集合直接或者间接连接着，搜索走过的路径称为<strong>引用链(Reference Chain)</strong></li>
<li>如果目标对象没有任何引用链连接，则是不可达的，就意味着该对象已经死亡，可以标记为垃圾对象。</li>
<li>在可达性分析算法中，只要被根对象集合直接或者间接连接的对象才是存活对象</li>
</ol>
<p><strong>注意</strong>：如果要使用可达性分析算法来判断内存是否可回收，那么分析工作必须在一个能保障一致性的快照中进行。这点不满足的话分析结果的准确性就无法保证。(也就是说在执行可达性分析算法时，内存中的对象是不能变动的)，这点也是导致GC进行时必须”Stop the world”的一个重要原因。</p>
<h4 id="2-1-3-GC-Roots对象有哪些"><a href="#2-1-3-GC-Roots对象有哪些" class="headerlink" title="2.1.3 GC Roots对象有哪些"></a>2.1.3 GC Roots对象有哪些</h4><p><strong>tips</strong>：<br>由于Root采用栈方式存放变量和指针，所以如果一个指针，它保存了堆内存里面的对象，但是自己又不存放在堆内存变量中，那它就是一个Root</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://lancersaber.github.io/2020/05/20/mybatis-plus/mybatis%20plus%E4%B8%BB%E9%94%AE%E7%94%9F%E6%88%90%E7%AD%96%E7%95%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lancersaber">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lancersaber">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/20/mybatis-plus/mybatis%20plus%E4%B8%BB%E9%94%AE%E7%94%9F%E6%88%90%E7%AD%96%E7%95%A5/" class="post-title-link" itemprop="url">mybatis-plus生成策略</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-05-20 18:40:18 / Modified: 18:49:17" itemprop="dateCreated datePublished" datetime="2020-05-20T18:40:18+08:00">2020-05-20</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mybatis-plus/" itemprop="url" rel="index">
                    <span itemprop="name">mybatis-plus</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="mybatis-plus生成策略"><a href="#mybatis-plus生成策略" class="headerlink" title="mybatis-plus生成策略"></a>mybatis-plus生成策略</h1><hr>
<p>在Mybatis plus查看IdType就知道了。<br>需要关注的是使用snowflake算法生成的主键id。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="Lancersaber"
    src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Lancersaber</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">203</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">59</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lancersaber</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.4.2
  </div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.2"></script><script src="/js/motion.js?v=7.4.2"></script>
<script src="/js/schemes/muse.js?v=7.4.2"></script>
<script src="/js/next-boot.js?v=7.4.2"></script>



  


















  

  

  

</body>
</html>
